<% layout('layouts/main') %>

<h1 class="text-3xl font-extrabold mb-6 text-center text-gray-800"><%= title %></h1>

<div class="flex px-6 mb-6">
  <a href="/admin/keys/new" class="px-5 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition duration-300 shadow-md">
    + Tạo Key mới
  </a>
</div>

<div class="overflow-x-auto mx-auto max-w-6xl px-4">
  <table class="min-w-full border border-gray-300 rounded-lg overflow-hidden shadow-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="text-left px-4 py-3 text-gray-700 uppercase text-sm font-semibold border-b border-gray-300">ID</th>
        <th class="text-left px-4 py-3 text-gray-700 uppercase text-sm font-semibold border-b border-gray-300">Token</th>
        <th class="text-left px-4 py-3 text-gray-700 uppercase text-sm font-semibold border-b border-gray-300">Branch</th>
        <th class="text-left px-4 py-3 text-gray-700 uppercase text-sm font-semibold border-b border-gray-300">Agency</th>
        <th class="text-center px-4 py-3 text-gray-700 uppercase text-sm font-semibold border-b border-gray-300">Status</th>
        <th class="text-center px-4 py-3 text-gray-700 uppercase text-sm font-semibold border-b border-gray-300">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (keys.length === 0) { %>
        <tr>
          <td colspan="6" class="text-center py-6 text-gray-500 italic">Chưa có key nào.</td>
        </tr>
      <% } %>
      <% keys.forEach(k => { %>
        <tr class="hover:bg-gray-50 transition duration-200">
          <td class="px-4 py-3 border-b border-gray-200 text-sm text-gray-700"><%= k._id %></td>
          <td class="px-4 py-3 border-b border-gray-200 text-sm text-gray-800 font-mono"><%= k.token %></td>
          <td class="px-4 py-3 border-b border-gray-200 text-sm text-gray-700"><%= k.branch ? k.branch.name : '-' %></td>
          <td class="px-4 py-3 border-b border-gray-200 text-sm text-gray-700"><%= k.branch && k.branch.agency ? k.branch.agency.name : '-' %></td>
          <td class="px-4 py-3 border-b border-gray-200 text-center text-sm">
            <% if (k.status === 'active') { %>
              <span class="inline-block px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">Active</span>
            <% } else { %>
              <span class="inline-block px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">Inactive</span>
            <% } %>
          </td>
          <td class="px-4 py-3 border-b border-gray-200 text-center text-sm">
            <form
              action="/admin/keys/<%= k._id %>/delete"
              method="POST"
              onsubmit="return confirm('Xóa key này?');"
              class="inline-block"
            >
              <button type="submit" class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition duration-300">
                Xóa
              </button>
            </form>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>
